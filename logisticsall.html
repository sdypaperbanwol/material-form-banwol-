<script>
const API = 'https://script.google.com/macros/s/AKfycbygJHqoFd7TejxGv-_k3UuJon2SCAYuJR50GyKW6Bk0lrmV0bC7k_ejc3IUR-e2KWO1qg/exec';

// KST 기준 YYYY-MM-DD (로컬 타임존과 무관하게 고정)
function todayKST() {
  const dtf = new Intl.DateTimeFormat('en-CA', { // en-CA => 2025-09-19 형식
    timeZone: 'Asia/Seoul',
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
  });
  return dtf.format(new Date()); // "YYYY-MM-DD"
}

async function fetchUnified(pc='00', car='') {
  const day = todayKST();
  const url = new URL(API);
  url.searchParams.set('api', 'unified');
  url.searchParams.set('day', day);
  url.searchParams.set('productClassification', pc);
  if (car) url.searchParams.set('carnum', car);

  const res = await fetch(url, { cache: 'no-store' });
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  const data = await res.json();
  if (data && data.ok === false) throw new Error(data.error || 'Unknown backend error');
  return data; // {ok, meta, incoming, arrival, vehicle}
}

// 예시 실행
fetchUnified('00','')
  .then(({incoming, arrival, vehicle, meta}) => {
    console.log('meta', meta);
    console.log('incoming', incoming.length, 'arrival', arrival.length, 'vehicle', vehicle.length);
    // renderIncoming(incoming); renderArrival(arrival); renderVehicle(vehicle);
  })
  .catch(err => {
    console.error('unified fetch error:', err);
  });
</script>
