<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>연차 계산기</title>
  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --border:#e6e8ee;
      --text:#111827;
      --muted:#6b7280;
      --accent:#111827;
      --shadow:0 10px 30px rgba(17,24,39,.08);
      --radius:14px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{max-width:920px;margin:34px auto;padding:0 16px;}
    .header{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin-bottom:14px;}
    h1{margin:0;font-size:22px;letter-spacing:-.2px;}
    .sub{margin:2px 0 0;color:var(--muted);font-size:13px;}
    .grid{display:grid;grid-template-columns: 1.2fr .8fr;gap:14px;}
    @media (max-width: 820px){ .grid{grid-template-columns:1fr;} }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .sectionTitle{font-size:13px;font-weight:700;color:var(--muted);margin:0 0 10px;}
    .formGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media (max-width: 520px){ .formGrid{grid-template-columns:1fr;} }
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px;}
    input, select{
      width:100%;
      padding:11px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus, select:focus{
      border-color:#c7cbe0;
      box-shadow: 0 0 0 4px rgba(17,24,39,.06);
    }
    .hint{font-size:12px;color:var(--muted);margin-top:6px;}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
    button{
      border:1px solid var(--border);
      background:#fff;
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
    }
    .btnPrimary{background:var(--accent);color:#fff;border-color:var(--accent);}
    .btnPrimary:hover{filter:brightness(1.05);}
    .btnGhost:hover{background:#f3f4f6;}
    .resultBox{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px;
      border:1px dashed #d6d9e6;
      border-radius:12px;
      background:#fafbff;
      margin-top:10px;
    }
    .who{display:flex;flex-direction:column;gap:4px;}
    .who .line1{font-weight:800;}
    .who .line2{font-size:12px;color:var(--muted);}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      background:#111827;
      color:#fff;
      font-size:11px;
      font-weight:700;
      width:fit-content;
    }
    .big{font-size:34px;font-weight:900;letter-spacing:-.5px;white-space:nowrap;}
    .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.5;}
    .details{margin-top:12px;border-top:1px solid var(--border);padding-top:12px;}
    .details pre{
      margin:0;
      white-space:pre-wrap;
      background:#fff;
      border:1px solid var(--border);
      padding:12px;
      border-radius:12px;
      font-size:12px;
      color:#111827;
    }
    .error{color:#b00020;font-weight:700;font-size:13px;margin-top:10px;}
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div>
      <h1>연차 계산기</h1>
      <div class="sub">입사일자와 기준일자를 입력하면 자동으로 산정 방식이 전환됩니다.</div>
    </div>
  </div>

  <div class="grid">
    <!-- Input -->
    <div class="card">
      <div class="sectionTitle">입력</div>

      <div class="formGrid">
        <div>
          <label>이름</label>
          <input id="name" type="text" placeholder="예) 홍길동" />
        </div>

        <div>
          <label>구분</label>
          <select id="type">
            <option value="normal">일반</option>
            <option value="contract">촉탁</option>
          </select>
        </div>

        <div>
          <label>입사일자 (YYYYMMDD)</label>
          <input id="join" inputmode="numeric" maxlength="8" placeholder="예) 20170417" />
          <div class="hint">숫자 8자리로 입력</div>
        </div>

        <div>
          <label>기준일자 (YYYYMMDD)</label>
          <input id="base" inputmode="numeric" maxlength="8" placeholder="예) 20260105" />
          <div class="hint">숫자 8자리로 입력</div>
        </div>
      </div>

      <div class="btnRow">
        <button class="btnPrimary" id="calcBtn">계산</button>
        <button class="btnGhost" id="resetBtn">초기화</button>
      </div>

      <div id="err" class="error" style="display:none;"></div>
    </div>

    <!-- Output -->
    <div class="card">
      <div class="sectionTitle">결과</div>

      <div class="resultBox" id="resultBox" style="display:none;">
        <div class="who">
          <div class="line1" id="whoLine">-</div>
          <div class="line2" id="metaLine">-</div>
          <div class="badge" id="modeBadge" style="display:none;">-</div>
        </div>
        <div class="big" id="outDays">-</div>
      </div>

      <div class="small" id="emptyHelp">
        입력 후 <b>계산</b>을 누르면 결과가 표시됩니다.
      </div>

      <div class="details" id="details" style="display:none;">
        <div class="sectionTitle">계산 내역</div>
        <pre id="explain"></pre>
      </div>
    </div>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  function onlyDigits8(el){
    el.addEventListener("input", () => {
      el.value = el.value.replace(/\D/g,"").slice(0,8);
    });
  }

  function parseYYYYMMDD(s){
    if (!s || s.length !== 8) return null;
    const y = Number(s.slice(0,4));
    const m = Number(s.slice(4,6));
    const d = Number(s.slice(6,8));
    if (!y || m<1 || m>12 || d<1 || d>31) return null;

    const dt = new Date(y, m-1, d);
    if (dt.getFullYear() !== y || dt.getMonth() !== (m-1) || dt.getDate() !== d) return null;
    return dt;
  }

  function fmt(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${dd}`;
  }

  function daysInYear(y){
    const a = new Date(y,0,1);
    const b = new Date(y+1,0,1);
    return Math.round((b-a)/86400000); // 365 or 366
  }

  function yearEnd(y){ return new Date(y,11,31); }

  function diffDaysInclusive(a,b){
    const A = new Date(a.getFullYear(), a.getMonth(), a.getDate());
    const B = new Date(b.getFullYear(), b.getMonth(), b.getDate());
    const diff = Math.round((B-A)/86400000);
    return diff >= 0 ? diff + 1 : 0;
  }

  function addDays(date, n){
    const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
    d.setDate(d.getDate() + n);
    return d;
  }

  function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }

  function isJan1(d){ return d.getMonth() === 0 && d.getDate() === 1; }

  // 15개 시작 "연도" (일반/촉탁의 1/1 부여 기준)
  function startYear15(join){
    return join.getFullYear() + (isJan1(join) ? 1 : 2);
  }

  // -----------------------------
  // ✅ 고용노동부(상담/안내)식 월차 발생:
  // "1개월을 채운 다음날 발생"
  //
  // 구현 방식:
  // - n개월 후 "같은 일자"가 존재하면:
  //     1개월 구간 종료일 = (n개월 후 같은 일자) - 1일
  //     발생일 = (n개월 후 같은 일자)
  //   예) 1/5 입사 -> 2/5 존재
  //       1개월 구간: 1/5~2/4, 발생: 2/5
  //
  // - n개월 후 "같은 일자"가 없으면(말일 케이스):
  //     1개월 구간 종료일 = n개월 후 해당월의 말일
  //     발생일 = 종료일 + 1일 (= 다음달 1일)
  //   예) 1/31 입사 -> 2/31 없음
  //       종료: 2/28, 발생: 3/1
  //   예) 3/31 입사 -> 4/31 없음
  //       종료: 4/30, 발생: 5/1
  // -----------------------------
  function monthPeriodEnd_MOEL(join, n){
    const y = join.getFullYear();
    const m = join.getMonth();
    const day = join.getDate();

    const targetY = y + Math.floor((m + n) / 12);
    const targetM = (m + n) % 12;

    const targetLast = new Date(targetY, targetM + 1, 0).getDate();

    if (day <= targetLast) {
      // n개월 후 같은 일자가 존재 -> 종료일은 그 전날
      // day=1이면 전날이 자연스럽게 전월 말일로 넘어감
      return new Date(targetY, targetM, day - 1);
    }

    // 같은 일자 없음 -> 그 달 말일이 종료일
    return new Date(targetY, targetM, targetLast);
  }

  function monthlyAccrualDate_MOEL(join, n){
    return addDays(monthPeriodEnd_MOEL(join, n), 1);
  }

  // 신입 누적(기준일까지): 일할 + 월차(최대 11)
  // - "입사 후 1개월 미만" 판정도 월차 발생일(=1개월 채운 다음날) 기준으로 컷
  // - 신입(15개 시작 전) 구간에는 상한 25 적용 없음
  function calcNewbieUpToBase(join, base){
    const joinY = join.getFullYear();

    const firstMonthlyAccrual = monthlyAccrualDate_MOEL(join, 1);
    if (base < firstMonthlyAccrual) {
      return {
        total: 0,
        detail: {
          prorated: 0,
          workedDays: diffDaysInclusive(join, base),
          yDays: daysInYear(joinY),
          endProrate: base,
          monthly: 0,
          accrualDates: [],
          anniv: new Date(join.getFullYear()+1, join.getMonth(), join.getDate()),
          firstMonthlyAccrual,
          firstMonthlyEnd: monthPeriodEnd_MOEL(join, 1)
        }
      };
    }

    // (1) 일할(입사연도)
    const endProrate = (base < yearEnd(joinY)) ? base : yearEnd(joinY);
    const workedDays = diffDaysInclusive(join, endProrate);
    const yDays = daysInYear(joinY);
    const prorated = Math.ceil((workedDays / yDays) * 15);

    // (2) 월차(최대 11, 기준일까지)
    const anniv = new Date(join.getFullYear()+1, join.getMonth(), join.getDate());

    let monthly = 0;
    const accrualDates = [];
    for (let k=1; k<=11; k++){
      accrualDates.push(monthlyAccrualDate_MOEL(join, k));
    }

    // 기준일까지 발생한 월차 카운트
    // (네가 원래 넣어둔 "마지막 1개 튐" 방지 장치 유지: '직전달 1일' 케이스 제외)
    const annivMonth = anniv.getMonth();
    const annivYear  = anniv.getFullYear();

    for (const d of accrualDates){
      if (d > base) continue;

      const isFirstDay = (d.getDate() === 1);
      const isMonthBeforeAnniv =
        (d.getFullYear() === annivYear) &&
        (d.getMonth() === ((annivMonth + 11) % 12)); // annivMonth-1

      if (base < anniv && isFirstDay && isMonthBeforeAnniv) {
        continue;
      }

      monthly += 1;
    }

    monthly = clamp(monthly, 0, 11);

    const total = prorated + monthly; // ✅ 신입 구간 상한 없음

    return {
      total,
      detail: {
        prorated,
        workedDays,
        yDays,
        endProrate,
        monthly,
        accrualDates,
        anniv,
        firstMonthlyAccrual,
        firstMonthlyEnd: monthPeriodEnd_MOEL(join, 1)
      }
    };
  }

  // 일반/촉탁(연 1회 1/1 확정 부여): "기준일의 연도" 연차
  function calcNormalForYear(join, baseYear){
    const s15 = startYear15(join);
    let leave = 0;

    if (baseYear < s15) {
      leave = 0;
    } else {
      leave = 15 + Math.floor((baseYear - s15)/2);
      leave = Math.min(25, leave);
    }
    return { total: leave, detail: { baseYear, s15 } };
  }

  function calcContractForYear(join, baseYear){
    // 촉탁 별도 규칙 있으면 여기만 교체
    return calcNormalForYear(join, baseYear);
  }

  // ---------- UI ----------
  onlyDigits8($("join"));
  onlyDigits8($("base"));

  function setError(msg){
    const el = $("err");
    if (!msg){
      el.style.display = "none";
      el.textContent = "";
      return;
    }
    el.style.display = "block";
    el.textContent = msg;
  }

  function showResult({name, typeLabel, join, base, total, explain, modeText}){
    $("emptyHelp").style.display = "none";
    $("resultBox").style.display = "flex";
    $("details").style.display = "block";

    $("whoLine").textContent = `${name} · ${typeLabel}`;
    $("metaLine").textContent = `입사 ${fmt(join)} · 기준일 ${fmt(base)}`;
    $("outDays").textContent = `${total} 개`;

    const badge = $("modeBadge");
    badge.style.display = "inline-flex";
    badge.textContent = modeText;

    $("explain").textContent = explain;
  }

  function resetAll(){
    $("name").value = "";
    $("type").value = "normal";
    $("join").value = "";
    $("base").value = "";
    setError("");

    $("resultBox").style.display = "none";
    $("details").style.display = "none";
    $("emptyHelp").style.display = "block";
    $("modeBadge").style.display = "none";
  }

  $("resetBtn").addEventListener("click", resetAll);

  $("calcBtn").addEventListener("click", () => {
    setError("");

    const name = ($("name").value.trim() || "이름없음");
    const type = $("type").value;
    const join = parseYYYYMMDD($("join").value.trim());
    const base = parseYYYYMMDD($("base").value.trim());

    if (!join || !base){
      setError("입사일자와 기준일자를 YYYYMMDD 형식(숫자 8자리)으로 입력해주세요.");
      return;
    }
    if (base < join){
      setError("기준일자는 입사일자보다 빠를 수 없습니다.");
      return;
    }

    const baseYear = base.getFullYear();
    const s15 = startYear15(join);

    let total = 0;
    let explain = "";
    let modeText = "";
    let typeLabel = (type === "normal") ? "일반" : "촉탁";

    if (baseYear < s15) {
      const res = calcNewbieUpToBase(join, base);
      total = res.total;
      modeText = (type === "contract") ? "신입(촉탁·자동)" : "신입(자동)";

      const d = res.detail;

      explain += `기준일까지 누적된 값으로 계산되었습니다.\n\n`;

      explain += `※ 월차(고용노동부식): "1개월을 채운 다음날" 발생\n`;
      explain += `- 1개월 구간 종료일: ${fmt(d.firstMonthlyEnd)}\n`;
      explain += `- 1개월차 발생일: ${fmt(d.firstMonthlyAccrual)}\n`;
      explain += `  (예: 1/31 입사 → 종료 2/28, 발생 3/1)\n\n`;

      explain += `① 일할(입사연도)\n`;
      explain += `- 기간: ${fmt(join)} ~ ${fmt(d.endProrate)}\n`;
      explain += `- 해당 연도 일수(윤년 반영): ${d.yDays}일\n`;
      explain += `- 근무일수(포함): ${d.workedDays}일\n`;
      explain += `- 일할 결과: ${d.prorated}개\n\n`;

      explain += `② 월차(최대 11)\n`;
      explain += `- 기준일까지 발생한 월차: ${d.monthly}개\n\n`;

      explain += `합계: ${total}개\n`;
    } else {
      const res = (type === "normal")
        ? calcNormalForYear(join, baseYear)
        : calcContractForYear(join, baseYear);

      total = res.total;
      modeText = (type === "contract") ? "촉탁(자동)" : "일반(자동)";

      const d = res.detail;
      explain += `${baseYear}년 연차로 계산되었습니다.\n\n`;
      explain += `- 입사일: ${fmt(join)}\n`;
      explain += `- 15개 시작: ${d.s15}년\n`;
      explain += `- 증가 규칙: 2년에 1개 증가 (최대 25개)\n\n`;
      explain += `결과: ${total}개\n`;
    }

    showResult({ name, typeLabel, join, base, total, explain, modeText });
  });

  resetAll();
</script>
</body>
</html>
