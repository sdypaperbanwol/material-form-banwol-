<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>연차 계산기</title>
  <style>
    :root{
      --bg:#f6f7f9;
      --card:#ffffff;
      --border:#e6e8ee;
      --text:#111827;
      --muted:#6b7280;
      --accent:#111827;
      --shadow:0 10px 30px rgba(17,24,39,.08);
      --radius:14px;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{max-width:920px;margin:34px auto;padding:0 16px;}
    .header{display:flex;align-items:flex-end;justify-content:space-between;gap:12px;margin-bottom:14px;}
    h1{margin:0;font-size:22px;letter-spacing:-.2px;}
    .sub{margin:2px 0 0;color:var(--muted);font-size:13px;}
    .grid{display:grid;grid-template-columns: 1.2fr .8fr;gap:14px;}
    @media (max-width: 820px){ .grid{grid-template-columns:1fr;} }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
    }
    .sectionTitle{font-size:13px;font-weight:700;color:var(--muted);margin:0 0 10px;}
    .formGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    @media (max-width: 520px){ .formGrid{grid-template-columns:1fr;} }
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px;}
    input, select{
      width:100%;
      padding:11px 12px;
      border:1px solid var(--border);
      border-radius:12px;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    input:focus, select:focus{
      border-color:#c7cbe0;
      box-shadow: 0 0 0 4px rgba(17,24,39,.06);
    }
    .hint{font-size:12px;color:var(--muted);margin-top:6px;}
    .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;}
    button{
      border:1px solid var(--border);
      background:#fff;
      padding:10px 14px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
    }
    .btnPrimary{background:var(--accent);color:#fff;border-color:var(--accent);}
    .btnPrimary:hover{filter:brightness(1.05);}
    .btnGhost:hover{background:#f3f4f6;}
    .resultBox{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px;
      border:1px dashed #d6d9e6;
      border-radius:12px;
      background:#fafbff;
      margin-top:10px;
    }
    .who{display:flex;flex-direction:column;gap:4px;}
    .who .line1{font-weight:800;}
    .who .line2{font-size:12px;color:var(--muted);}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:4px 10px;
      border-radius:999px;
      background:#111827;
      color:#fff;
      font-size:11px;
      font-weight:700;
      width:fit-content;
    }
    .big{font-size:34px;font-weight:900;letter-spacing:-.5px;white-space:nowrap;}
    .small{font-size:12px;color:var(--muted);margin-top:10px;line-height:1.5;}
    .details{margin-top:12px;border-top:1px solid var(--border);padding-top:12px;}
    .details pre{
      margin:0;
      white-space:pre-wrap;
      background:#fff;
      border:1px solid var(--border);
      padding:12px;
      border-radius:12px;
      font-size:12px;
      color:#111827;
    }
    .error{color:#b00020;font-weight:700;font-size:13px;margin-top:10px;}
  </style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div>
      <h1>연차 계산기</h1>
      <div class="sub">입사일자와 기준일자를 입력하면 해당 연도의 연차 개수를 계산합니다.</div>
    </div>
  </div>

  <div class="grid">
    <!-- Input -->
    <div class="card">
      <div class="sectionTitle">입력</div>

      <div class="formGrid">
        <div>
          <label>이름</label>
          <input id="name" type="text" placeholder="예) 홍길동" />
        </div>

        <div>
          <label>구분</label>
          <select id="type">
            <option value="normal">일반</option>
            <option value="contract">촉탁</option>
          </select>
        </div>

        <div>
          <label>입사일자 (YYYYMMDD)</label>
          <input id="join" inputmode="numeric" maxlength="8" placeholder="예) 20170417" />
          <div class="hint">숫자 8자리로 입력</div>
        </div>

        <div>
          <label>기준일자 (YYYYMMDD)</label>
          <input id="base" inputmode="numeric" maxlength="8" placeholder="예) 20260105" />
          <div class="hint">숫자 8자리로 입력</div>
        </div>
      </div>

      <div class="btnRow">
        <button class="btnPrimary" id="calcBtn">계산</button>
        <button class="btnGhost" id="resetBtn">초기화</button>
      </div>

      <div id="err" class="error" style="display:none;"></div>
    </div>

    <!-- Output -->
    <div class="card">
      <div class="sectionTitle">결과</div>

      <div class="resultBox" id="resultBox" style="display:none;">
        <div class="who">
          <div class="line1" id="whoLine">-</div>
          <div class="line2" id="metaLine">-</div>
          <div class="badge" id="modeBadge" style="display:none;">-</div>
        </div>
        <div class="big" id="outDays">-</div>
      </div>

      <div class="small" id="emptyHelp">
        입력 후 <b>계산</b>을 누르면 결과가 표시됩니다.
      </div>

      <div class="details" id="details" style="display:none;">
        <div class="sectionTitle">계산 내역</div>
        <pre id="explain"></pre>
      </div>
    </div>
  </div>
</div>

<script>
  const $ = (id) => document.getElementById(id);

  function onlyDigits8(el){
    el.addEventListener("input", () => {
      el.value = el.value.replace(/\D/g,"").slice(0,8);
    });
  }
function nextMonthlyAccDate(join){
  // 규칙: "입사일의 다음달 같은 일"
  // 단, 그 일이 존재하지 않으면 "그 다음달 1일"
  const y = join.getFullYear();
  const m = join.getMonth();
  const d = join.getDate();

  const cand = new Date(y, m + 1, d); // 다음달 같은 일 시도
  const target = new Date(y, m + 1, 1); // 다음달 1일(목표월 확인용)

  // cand가 목표월에 그대로 있으면 OK
  if (cand.getFullYear() === target.getFullYear() && cand.getMonth() === target.getMonth()) {
    return cand;
  }
  // 없으면 "그 다음달 1일"
  return new Date(target.getFullYear(), target.getMonth() + 1, 1);
}

function addMonthsSameDay(d, n){
  // 여기서는 그냥 “달 +n, 같은 일”만 쓰면 됨 (월차일이 대부분 1일로 고정될 테니까)
  // 그래도 안전하게 clamp 처리
  const y = d.getFullYear();
  const m = d.getMonth();
  const day = d.getDate();
  const first = new Date(y, m + n, 1);
  const lastDay = new Date(first.getFullYear(), first.getMonth() + 1, 0).getDate();
  return new Date(first.getFullYear(), first.getMonth(), Math.min(day, lastDay));
}

function countMonthlyUpTo11(join, baseDate){
  let count = 0;
  let acc = nextMonthlyAccDate(join);  // 1번째 월차 부여일
  for (let i = 1; i <= 11; i++){
    if (acc <= baseDate) count++;
    // 다음 월차 (첫 부여일 기준으로 +1개월씩)
    acc = addMonthsSameDay(acc, 1);
  }
  return count;
}

  function parseYYYYMMDD(s){
    if (!s || s.length !== 8) return null;
    const y = Number(s.slice(0,4));
    const m = Number(s.slice(4,6));
    const d = Number(s.slice(6,8));
    if (!y || m<1 || m>12 || d<1 || d>31) return null;

    const dt = new Date(y, m-1, d);
    if (dt.getFullYear() !== y || dt.getMonth() !== (m-1) || dt.getDate() !== d) return null;
    return dt;
  }

  function fmt(d){
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${dd}`;
  }


function addMonths(d, n){
  const y = d.getFullYear();
  const m = d.getMonth();
  const day = d.getDate();

  // 목표 월의 "같은 일"을 먼저 시도
  const cand = new Date(y, m + n, day);

  // JS Date는 2/31 같은 걸 자동으로 3/03처럼 굴려버릴 수 있으니
  // "목표 월"에 제대로 안착했는지 확인
  const targetMonth = (new Date(y, m + n, 1)).getMonth();
  const targetYear  = (new Date(y, m + n, 1)).getFullYear();

  const ok = (cand.getFullYear() === targetYear && cand.getMonth() === targetMonth);

  if (ok) return cand;

  // 같은 일이 없는 달이면: "다음달 1일"로 처리
  return new Date(targetYear, targetMonth + 1, 1);
}

  function daysInYear(y){
    const a = new Date(y,0,1);
    const b = new Date(y+1,0,1);
    return Math.round((b-a)/86400000); // 365 or 366
  }

  function yearEnd(y){ return new Date(y,11,31); }

  function diffDaysInclusive(a,b){
    const A = new Date(a.getFullYear(), a.getMonth(), a.getDate());
    const B = new Date(b.getFullYear(), b.getMonth(), b.getDate());
    const diff = Math.round((B-A)/86400000);
    return diff >= 0 ? diff + 1 : 0;
  }

  // 완전히 경과한 개월 수(Excel DATEDIF "m" 느낌)
  function datedifMonths(start, end){
    if (end < start) return 0;
    let y = end.getFullYear() - start.getFullYear();
    let m = end.getMonth() - start.getMonth();
    let months = y*12 + m;
    if (end.getDate() < start.getDate()) months -= 1;
    return Math.max(0, months);
  }

  function clamp(n, lo, hi){ return Math.max(lo, Math.min(hi, n)); }
  function isJan1(d){ return d.getMonth() === 0 && d.getDate() === 1; }

  // 15개 시작 연도
  function startYear15(join){
    return join.getFullYear() + (isJan1(join) ? 1 : 2);
  }

  /**
   * 신입(전년도 발생분) 계산:
   * - baseYear 연차 = (baseYear-1) 발생분을 반영
   * - 일할(전년도 12/31까지) + 월차(기준일까지, 최대 11번째까지)
   *
   * 핵심 수정:
   * - 월차는 전년도 12/31에서 자르지 않고, "기준일(baseDate)"까지 발생한 것을 반영
   *   (단, 11번째 부여일까지로 상한)
   */
function calcNewAccrualForYear(join, baseDate){
  const baseYear = baseDate.getFullYear();
  const accrualYear = baseYear - 1;
  const endOfAccrualYear = yearEnd(accrualYear);


  // 전년도에 아직 입사 전이면 0
  if (accrualYear < join.getFullYear()) {
    return {
      total: 0,
      detail: {
        accrualYear,
        start: null,
        end: endOfAccrualYear,
        workedDays: 0,
        yearDays: daysInYear(accrualYear),
        prorated: 0,
        firstAcc: addMonths(join, 1),
        eleventhAcc: addMonths(join, 11),
        effectiveEnd: null,
        monthly: 0
      }
    };
  }

  // (A) 일할: 전년도(=accrualYear) 안에서만
  const startForProrate =
    (accrualYear === join.getFullYear()) ? join : new Date(accrualYear, 0, 1);

  const workedDays = diffDaysInclusive(startForProrate, endOfAccrualYear);
  const yDays = daysInYear(accrualYear); // 윤년 반영(365/366)
  const prorated = Math.ceil((workedDays / yDays) * 15);

  // (B) 월차: "전년도 12/31까지"만 반영 (기준일이 2026-xx-xx여도 동일)
  const firstAcc = addMonths(join, 1);
  const eleventhAcc = addMonths(join, 11);

  // 전년도 말 vs 11번째 부여일 중 더 빠른 날까지만
const monthlyEndCap = (baseDate < eleventhAcc) ? baseDate : eleventhAcc;

  let monthly = 0;
  if (monthlyEndCap >= firstAcc) {
    monthly = datedifMonths(firstAcc, monthlyEndCap) + 1; // 부여일 포함
  }
  monthly = clamp(monthly, 0, 11);

  return {
    total: prorated + monthly,
    detail: {
      accrualYear,
      start: startForProrate,
      end: endOfAccrualYear,
      workedDays,
      yearDays: yDays,
      prorated,
      firstAcc,
      eleventhAcc,
      effectiveEnd: monthlyEndCap,
      monthly
    }
  };
}


  // 일반 계산(연 1회 1/1 부여): baseYear 연차
  function calcNormalForYear(join, baseYear){
    const s15 = startYear15(join);
    let leave = 0;

    if (baseYear < s15) {
      leave = 0;
    } else {
      leave = 15 + Math.floor((baseYear - s15)/2);
      leave = Math.min(25, leave);
    }

    return { total: leave, detail: { baseYear, s15 } };
  }

  // 촉탁: 초안에서는 일반과 동일
  function calcContractForYear(join, baseYear){
    return calcNormalForYear(join, baseYear);
  }

  // ---------- UI ----------
  onlyDigits8($("join"));
  onlyDigits8($("base"));

  function setError(msg){
    const el = $("err");
    if (!msg){
      el.style.display = "none";
      el.textContent = "";
      return;
    }
    el.style.display = "block";
    el.textContent = msg;
  }

  function showResult({name, typeLabel, join, base, total, explain, modeText}){
    $("emptyHelp").style.display = "none";
    $("resultBox").style.display = "flex";
    $("details").style.display = "block";

    $("whoLine").textContent = `${name} · ${typeLabel}`;
    $("metaLine").textContent = `입사 ${fmt(join)} · 기준일 ${fmt(base)} (표시: ${base.getFullYear()}년 연차)`;
    $("outDays").textContent = `${total} 개`;

    const badge = $("modeBadge");
    badge.style.display = "inline-flex";
    badge.textContent = modeText;

    $("explain").textContent = explain;
  }

  function resetAll(){
    $("name").value = "";
    $("type").value = "normal";
    $("join").value = "";
    $("base").value = "";
    setError("");

    $("resultBox").style.display = "none";
    $("details").style.display = "none";
    $("emptyHelp").style.display = "block";
    $("modeBadge").style.display = "none";
  }

  $("resetBtn").addEventListener("click", resetAll);

  $("calcBtn").addEventListener("click", () => {
    setError("");

    const name = ($("name").value.trim() || "이름없음");
    const type = $("type").value;
    const join = parseYYYYMMDD($("join").value.trim());
    const base = parseYYYYMMDD($("base").value.trim());

    if (!join || !base){
      setError("입사일자와 기준일자를 YYYYMMDD 형식(숫자 8자리)으로 입력해주세요.");
      return;
    }
    if (base < join){
      setError("기준일자는 입사일자보다 빠를 수 없습니다.");
      return;
    }

    const baseYear = base.getFullYear();
    const s15 = startYear15(join);

    let total = 0;
    let explain = "";
    let modeText = "";
    const typeLabel = (type === "normal") ? "일반" : "촉탁";

    // 자동 분기: baseYear < 15개 시작연도면 "신입 산정", 아니면 "일반/촉탁 산정"
    if (baseYear < s15) {
      // 신입 산정 (전년도 발생분 + 월차는 기준일까지 반영)
      const newRes = calcNewAccrualForYear(join, base);
      total = newRes.total;
      modeText = "신입 산정(자동)";

      const d = newRes.detail;
      explain += `신입 구간으로 계산되었습니다.\n`;
      explain += `- ${baseYear}년 연차는 ${baseYear-1}년에 발생한 내용을 반영합니다.\n\n`;

      explain += `일할 계산(전년도 기준)\n`;
      explain += `- 발생 기간: ${fmt(d.start)} ~ ${fmt(d.end)}\n`;
      explain += `- 해당 연도 일수(윤년 반영): ${d.yearDays}일\n`;
      explain += `- 근무일수(포함): ${d.workedDays}일\n`;
      explain += `- 일할(15 기준): ${d.prorated}개\n\n`;

      explain += `월차(최대 11)\n`;
      explain += `- 첫 부여일: ${fmt(d.firstAcc)}\n`;
      explain += `- 최대 반영(11번째): ${fmt(d.eleventhAcc)}\n`;
      explain += `- 반영 종료일: ${fmt(d.effectiveEnd)} (기준일까지 반영)\n`;
      explain += `- 월차: ${d.monthly}개\n\n`;

      explain += `결과: ${total}개`;
    } else {
      // 일반/촉탁 산정
      const normalRes = (type === "normal")
        ? calcNormalForYear(join, baseYear)
        : calcContractForYear(join, baseYear);

      total = normalRes.total;
      modeText = "일반 산정(자동)";

      const d = normalRes.detail;
      const reason = "1년 만근 시 다음 해부터 15개가 시작됩니다.";

      explain += `${baseYear}년 연차로 계산되었습니다.\n\n`;
      explain += `- 입사일: ${fmt(join)}\n`;
      explain += `- 15개 시작: ${d.s15}년\n`;
      explain += `- 안내: ${reason}\n`;
      explain += `- 증가 규칙: 2년에 1개 증가 (최대 25개)\n\n`;
      explain += `결과: ${total}개`;
    }

    showResult({ name, typeLabel, join, base, total, explain, modeText });
  });

  // initial
  resetAll();
</script>
</body>
</html>
