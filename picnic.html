<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë°˜ë³„ ì•¼ìœ íšŒ ì•ˆë‚´ë¬¸ ìƒì„±ê¸°</title>
  <style>
    :root{
      --brand:#e53935; --ink:#222; --muted:#666; --line:#ddd; --bg:#f7f7f9;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:14px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
    .wrap{max-width:1200px;margin:32px auto;padding:0 16px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .toolbar button{
      border:1px solid var(--line);background:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;
      box-shadow:0 1px 2px rgba(0,0,0,.06);
    }
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    .card{background:#fff;border:1px solid var(--line);border-radius:16px;box-shadow:0 4px 12px rgba(0,0,0,.06)}
    .card h2{margin:0;padding:16px 18px;border-bottom:1px solid var(--line);display:flex;align-items:center;gap:10px}
    .card .body{padding:18px}
    .f{display:grid;gap:12px}
    .row{display:grid;grid-template-columns:120px 1fr;gap:10px;align-items:start}
    .row label{font-weight:700;padding-top:6px}
    input[type=text], input[type=date], textarea, select{
      width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;outline:none
    }
    textarea{min-height:110px;resize:vertical}
    @media print{ .no-print, .toolbar{display:none !important} body{background:#fff} .wrap{max-width:900px} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="toolbar no-print">
  <button id="btnShare">ì„ì‹œ ì €ì¥(ì§§ì€ ë§í¬)</button>
  <button id="btnCopyText">í…ìŠ¤íŠ¸ ë³µì‚¬</button>
  <button id="btnSubmit">ì „ì†¡(ì¸ì‚¬ì§€ì›íŒ€)</button>
  <!-- â–¼ ì—¬ê¸°ì— ê³µìœ  ë§í¬ í‘œì‹œ -->
  <input id="shareLink" readonly 
         style="flex:1; min-width:260px; max-width:560px; padding:6px 10px; border:1px solid #ddd; border-radius:6px;" 
         placeholder="ê³µìœ  ë§í¬ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤" />
</div>


    <div class="grid">
      <div class="card no-print">
        <h2>ì…ë ¥ í¼</h2>
        <div class="body">
          <div class="f">
            <div class="row">
              <label for="team">ë°˜ ì„ íƒ</label>
              <select id="team">
                <option value="A">Aë°˜</option>
                <option value="B">Bë°˜</option>
                <option value="C">Cë°˜</option>
                <option value="D">Dë°˜</option>
              </select>
            </div>
            <div class="row">
              <label for="title">ì œëª©(ì„ íƒ)</label>
              <input id="title" type="text" placeholder="ì˜ˆ) Aë°˜ ì•¼ìœ íšŒ ì•ˆë‚´" />
            </div>
            <div class="row">
              <label for="date">ì¼ì</label>
              <input id="date" type="date" />
            </div>
            <div class="row">
              <label for="schedule">ì¼ì • ìš”ì•½</label>
              <textarea id="schedule" placeholder="ì˜ˆì‹œ)
06:00 í™”ë‘ìœ ì›ì§€ ì§‘ê²°
06:30 ë²„ìŠ¤ ì¶œë°œ
11:00 XX ê´€ëŒ ì‹œì‘
12:30 ì ì‹¬ ì‹ì‚¬
15:00 ê·€ê°€"></textarea>
            </div>
            <div class="row">
              <label for="place">ì¥ì†Œ</label>
              <input id="place" type="text" placeholder="ì˜ˆ) XXX (ì£¼ì†ŒëŠ” ì„ íƒì‚¬í•­)" />
            </div>
            <div class="row">
              <label for="notes">íŠ¹ì´ì‚¬í•­</label>
              <textarea id="notes" placeholder="ì˜ˆ) 
Â· í¸í•œ ë³µì¥ ë° ìš´ë™í™” ê¶Œì¥
Â· ê°œì¸ ë¬¼/ìš°ì˜ ë“± ì¤€ë¹„
Â· ì „ì„¸ë²„ìŠ¤ ëŒ€ì ˆ (ê°œë³„ ì§‘ê²° ì—†ìŒ)
Â· ì¼ë¶€ êµ¬ê°„ì€ ë„ë³´ ì´ë™ ì˜ˆì •"></textarea>
            </div>
            <div class="row">
              <label for="contact">ë¬¸ì˜ì²˜</label>
              <input id="contact" type="text" placeholder="ì˜ˆ) Aë°˜ í™ê¸¸ë™ (010-0000-0000)" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- LZ-String: URIìš© ì••ì¶•/ë³µì› -->
  <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

  <script>
    const GAS_URL = 'https://script.google.com/macros/s/AKfycby6_HAA7IWUjn-E5Qg2Tqqz8V54Di51KNwamYcPGP_giUS1rU3ruzeBfsluC8kcYpYf/exec';

    function weekdayKR(dateStr){
      if(!dateStr) return '';
      const d = new Date(dateStr+'T00:00:00');
      const yo = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '][d.getDay()];
      return `${d.getFullYear()}ë…„ ${d.getMonth()+1}ì›” ${d.getDate()}ì¼(${yo})`;
    }
    function collect(){
      return {
        team: document.getElementById('team').value,
        title: document.getElementById('title').value,
        date: document.getElementById('date').value,
        schedule: document.getElementById('schedule').value,
        place: document.getElementById('place').value,
        notes: document.getElementById('notes').value,
        contact: document.getElementById('contact').value,
      };
    }
    function decodeShare(b64){
      try{ return JSON.parse(decodeURIComponent(escape(atob(b64)))); }
      catch(e){ alert('ê³µìœ  ì½”ë“œ í•´ì„ ì‹¤íŒ¨'); return null }
    }

    // â–¼ ê³µìœ (ì„ì‹œ ì €ì¥): LZ-Stringìœ¼ë¡œ ì••ì¶•í•´ URL íŒŒë¼ë¯¸í„°ì— ë‹´ê¸°
  document.getElementById('btnShare').addEventListener('click', async ()=>{
  try{
    const data = collect();
    const res = await fetch(GAS_URL, {
      method: 'POST',
      headers: {'Content-Type':'text/plain;charset=utf-8'},
      body: JSON.stringify({ mode:'share', data })
    });
    const json = await res.json();
  if (json.status === 'ok' && json.key) {
  const url = new URL(window.location.href);
  url.searchParams.delete('code');
  url.searchParams.delete('c');
  url.searchParams.set('k', json.key);

  history.replaceState(null, '', url.toString());

  // â˜… ì—¬ê¸° ì¶”ê°€
  document.getElementById('shareLink').value = url.toString();

  await navigator.clipboard.writeText(url.toString());
  alert('ì§§ì€ ê³µìœ  ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
}



    // â–¼ ì˜ˆì˜ê²Œ í¬ë§·ëœ í…ìŠ¤íŠ¸ ë³µì‚¬
    document.getElementById('btnCopyText').addEventListener('click', ()=>{
      const d = collect();
      const dateStr = d.date ? weekdayKR(d.date) : '-';

      const lines = [];
      lines.push(`ğŸ“Œ ${d.title||d.team+"ë°˜ ì•¼ìœ íšŒ ì•ˆë‚´"}`);
      lines.push("â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
      lines.push(`ğŸ“… ì¼ì: ${dateStr}`);
      lines.push("");
      lines.push("ğŸšŒ ì¼ì • ìš”ì•½");
      lines.push(...(d.schedule||'').split('\n').map(s=>"- "+s));
      lines.push("");
      lines.push(`ğŸ“ ì¥ì†Œ: ${d.place||'-'}`);
      if((d.notes||'').trim()){
        lines.push("");
        lines.push("â„¹ï¸ íŠ¹ì´ì‚¬í•­");
        lines.push(...d.notes.split('\n').map(s=>"- "+s));
      }
      lines.push("");
      lines.push(`â˜ ë¬¸ì˜ì²˜: ${d.contact||'-'}`);
      lines.push("â”â”â”â”â”â”â”â”â”â”â”â”â”â”");

      const text = lines.join('\n');
      navigator.clipboard.writeText(text).then(()=>{
        alert('ì˜ˆì˜ê²Œ í¬ë§·ëœ í…ìŠ¤íŠ¸ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
      }).catch(()=>{
        prompt('ë³µì‚¬ ì‹¤íŒ¨. ì•„ë˜ ë‚´ìš©ì„ ìˆ˜ë™ ë³µì‚¬í•˜ì„¸ìš”.', text);
      });
    });

    // â–¼ ì§„ì§œ ì œì¶œ(ì‹œíŠ¸ë¡œ ì „ì†¡)
    async function submitToSheet(){
      try{
        const data = collect();
        if(!data.date){ alert('ì¼ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if(!(data.schedule||'').trim()){ alert('ì¼ì • ìš”ì•½ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        if(!data.contact){ alert('ë¬¸ì˜ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        const payload = { ...data, submitted_at: new Date().toISOString(), mode: 'append' };
        const res = await fetch(GAS_URL, {
          method: 'POST',
          headers: {'Content-Type': 'text/plain;charset=utf-8'},
          body: JSON.stringify(payload)
        });
        const json = await res.json().catch(()=>({}));
        if (json.status === 'ok' || json.result === 'ok'){
          alert(`ì œì¶œ ì™„ë£Œ! ì ‘ìˆ˜ë²ˆí˜¸: ${json.id||json.row||'í™•ì¸ë¨'}`);
        }else{
          alert(`ì œì¶œ ì‹¤íŒ¨: ${json.error||'unknown'}`);
        }
      }catch(err){
        alert('ì œì¶œ ì¤‘ ì˜¤ë¥˜: '+ err.message);
      }
    }
    document.getElementById('btnSubmit').addEventListener('click', submitToSheet);

    // â–¼ ì´ˆê¸° ë¡œë”©: c(ì••ì¶• ë§í¬) ìš°ì„ , ì—†ìœ¼ë©´ code(base64) í•˜ìœ„í˜¸í™˜
(function init(){
  const p = new URLSearchParams(location.search);
  const k = p.get('k');     // â˜… ìƒˆ ë°©ì‹
  const c = p.get('c');     // ì••ì¶• ë°©ì‹
  const code = p.get('code'); // êµ¬ë²„ì „ base64

  if (k) {
    // â˜… ì§§ì€ í‚¤ ë°©ì‹: GASì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
    fetch(`${GAS_URL}?mode=load&key=${encodeURIComponent(k)}`)
      .then(r=>r.json()).then(json=>{
        if (json.status==='ok' && json.data) {
          const d = json.data;
          document.getElementById('team').value     = d.team||'A';
          document.getElementById('title').value    = d.title||'';
          document.getElementById('date').value     = d.date||'';
          document.getElementById('schedule').value = d.schedule||'';
          document.getElementById('place').value    = d.place||'';
          document.getElementById('notes').value    = d.notes||'';
          document.getElementById('contact').value  = d.contact||'';
        } else {
          alert('ê³µìœ  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ì–´ìš”.');
        }
      }).catch(()=>alert('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ê³µìœ  ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'));
    return; // â˜… ì—¬ê¸°ì„œ ëëƒ„
  }

  if (c && window.LZString) {
    try {
      const data = JSON.parse(LZString.decompressFromEncodedURIComponent(c) || '{}');
      document.getElementById('team').value     = data.team||'A';
      document.getElementById('title').value    = data.title||'';
      document.getElementById('date').value     = data.date||'';
      document.getElementById('schedule').value = data.schedule||'';
      document.getElementById('place').value    = data.place||'';
      document.getElementById('notes').value    = data.notes||'';
      document.getElementById('contact').value  = data.contact||'';
    } catch(e) {
      alert('ê³µìœ  ë°ì´í„° í•´ì„ ì‹¤íŒ¨(c): '+e.message);
    }
    return;
  }

  if (code) {
    const data = decodeShare(code);
    if (data) {
      document.getElementById('team').value     = data.team||'A';
      document.getElementById('title').value    = data.title||'';
      document.getElementById('date').value     = data.date||'';
      document.getElementById('schedule').value = data.schedule||'';
      document.getElementById('place').value    = data.place||'';
      document.getElementById('notes').value    = data.notes||'';
      document.getElementById('contact').value  = data.contact||'';
    }
    return;
  }

  // ì•„ë¬´ íŒŒë¼ë¯¸í„°ë„ ì—†ì„ ë•Œ ê¸°ë³¸ê°’
  document.getElementById('title').value = 'Aë°˜ ì•¼ìœ íšŒ ì•ˆë‚´';
})();

  </script>
</body>
</html>
